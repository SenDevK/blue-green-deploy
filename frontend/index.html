<!-- frontend/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Poll</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.4.0/socket.io.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-2xl mx-4">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">
            What's Your Favorite Tech?
            <span class="bg-green-500 text-white text-xs font-bold ml-2 px-2.5 py-1 rounded-full align-middle">v2</span>
        </h1>
        <div id="poll-options" class="grid grid-cols-2 gap-4 mb-6">
            <!-- Poll options will be dynamically added here -->
        </div>
        <hr class="my-6">
        <h2 class="text-2xl font-semibold text-gray-700 mb-4 text-center">Live Results</h2>
        <div id="results" class="space-y-3">
            <!-- Results will be dynamically added here -->
        </div>
    </div>

    <script>
        // Connect to the backend WebSocket server using a relative path.
        // This tells the browser to connect to the same host that served the page,
        // allowing the Ingress to route the WebSocket connection correctly.
        const socket = io({ path: "/socket.io/" });

        const pollOptionsContainer = document.getElementById('poll-options');
        const resultsContainer = document.getElementById('results');

        // Listen for the 'update' event from the server
        socket.on('update', (pollData) => {
            // Clear previous options and results
            pollOptionsContainer.innerHTML = '';
            resultsContainer.innerHTML = '';

            const totalVotes = Object.values(pollData).reduce((sum, count) => sum + count, 0);

            for (const [option, votes] of Object.entries(pollData)) {
                // Create vote buttons
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'bg-blue-600 text-white font-semibold p-4 rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-600';
                button.onclick = () => vote(option);
                pollOptionsContainer.appendChild(button);

                // Display results
                const percentage = totalVotes === 0 ? 0 : ((votes / totalVotes) * 100).toFixed(1);
                const resultDiv = document.createElement('div');
                resultDiv.className = 'w-full bg-gray-200 rounded-full h-8';
                resultDiv.innerHTML = `
                    <div class="bg-green-500 h-8 rounded-full flex items-center justify-between px-4 text-white font-bold" style="width: ${percentage}%">
                        <span>${option}</span>
                        <span>${votes} votes (${percentage}%)</span>
                    </div>
                `;
                resultsContainer.appendChild(resultDiv);
            }
        });

        // Function to send a 'vote' event to the server
        function vote(option) {
            socket.emit('vote', option);
        }
    </script>
</body>
</html>
